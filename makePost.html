<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Make a post</title>

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

		<link rel="stylesheet" type="text/css" href="resources/styles.css">

		<!-- util.js contains functions that are used on multiple pages of the site -->
		<script type="text/javascript" src="resources/util.js"></script>
    </head>

    <body>

		<!-- header section -->
        <div class="container bg-color-orange-dark">
            <div class="row">
                <div class="col-sm">
					<img src="resources/images/icon.png" alt="Trust Network Logo">
                </div>
				<div class="col-sm">
					<h1 class="welcomText">say something...</h1>
                </div>
				<div class="col-sm">
					<button class="btn btn-primary" onclick="">Settings</button>
					<button class="btn btn-primary" onclick="">Logout</button>
                </div>
            </div>
        </div>

		<!-- mid section -->
		<div class="container bg-color-orange-medium">
			<div class="row">
				<div class="col-sm-12 col-lg-6">
					<div class="row">
						<canvas id="imageCanvas" src="noimage.jpg" width="320" height="240"></canvas>
					</div>
					<div class="row">
						<input id="fileToUpload" type="file" name="aFile">
					    <button class="btn btn-primary" onclick="uploadImage()">Upload</button>
					</div>


				</div>
				<div class="col-sm-12 col-lg-6">

					<!-- the onsubmit attribute allows the text to be processed before it is submitted to the database -->
					<form action="makePost.php" method="POST" onsubmit="encodeText()">
						<textarea class="makePostText" name="postText" id="postText" rows="5" cols="40"></textarea><br><br>
						<input class="btn btn-primary" type="submit" value="Submit" name="submit">
						 <input type="hidden" id="imagedata" name="imagedata" /> 
					</form>

				</div>
			</div>
		</div>
		
		<!-- footer section -->
		<div class="container bg-color-orange-light">
			<div class="row">
				<div class="col-sm">
					<p>kludge</p>
					<p>kludge</p>
					<p>kludge</p>
					
				</div>
			</div>
		</div>

		<script>

			/* search the document cookie to find the users key that will be used to
			encode text and images (locally) before uploading to the database*/
			var userKey = parseInt(getCookie("key"));

            var canvas = document.getElementById("imageCanvas");
            var canvasContext = canvas.getContext("2d");

			/*var base_image = new Image();
            base_image.src = "noimage.jpg";
            canvasContext.drawImage(base_image, 100, 100);*/

            function uploadImage()
            {
                var uploadedImage = document.createElement("IMG");

                var fileToOpen = document.getElementById("fileToUpload").value;
		
				fileToOpen = fileToOpen.replace("C:\\fakepath\\","");

				uploadedImage.setAttribute("src", fileToOpen);
                uploadedImage.setAttribute("width", "320");
                uploadedImage.setAttribute("height", "240");
                uploadedImage.setAttribute("alt", "Uploaded image");
                //document.body.appendChild(uploadedImage); //!

				canvasContext.drawImage(uploadedImage,0,0,320,240);

				var imageData = canvasContext.getImageData(0, 0, 320, 240);

				document.getElementById("imagedata").value = imageData.data;

				//document.getElementById("imagedata").value = "1,2,3";

				imageData.data = encodeImage(imageData.data);

				document.getElementById("imagedata").value = imageData.data;

            }

			function post()
			{
				
			}

			/* this function iterates over the text in the text field and eciphers
			it according to the users key*/
			function encodeText()
			{
				var textToEncrypt = document.getElementById("postText").value;
				var newString = "";
			
				for(var i = 0; i < textToEncrypt.length; i++)
				{
					//the if else statements here are required to eliminate symbols from
					//being processed, these were causing html to render the pages improperly
					if(textToEncrypt.charAt(i) == " ")
					{
						newString += String.fromCharCode(textToEncrypt.charCodeAt(i));
					}
					else
					{
						newString += String.fromCharCode(textToEncrypt.charCodeAt(i) + userKey);
					}

					document.getElementById("postText").value = newString;

				}
			}

			function encodeImage(arg)
			{
				var encodeArray = [];
			
				var random = new RNG(userKey);

				var nextRandomNumber = 0;

				while(encodeArray.length < 256)
				{
					nextRandomNumber = random.nextRange(0, 256);

					if(encodeArray.indexOf(nextRandomNumber) == -1)
					{
						encodeArray.push(nextRandomNumber);
					}
				}

				for(var i = 0; i < arg.length; i++)
				{
					arg[i] = encodeArray.indexOf(arg[i]);
				}

				/*for(var i = 0; i < arg.length; i += 4)
				{
					arg[i] = red[arg[i] - 1];
					arg[i + 1] = green[arg[i+1] - 1];
					arg[i + 2] = blue[arg[i+2] - 1];
				}*/
			
				return arg;
			
			}

        </script>
    </body>
</html>