<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Image Opener</title>
    </head>

    <body>

		<input id="fileToUpload" type="file" name="aFile">
		<br>

        <canvas id="imageCanvas" src="noimage.jpg" width="640" height="480"></canvas>
		<br>

        <button onclick="uploadImage()">Upload</button>
		<br>

		<p>Type your message</p>
        <form action="makePost.php" method="POST">
            <textarea name="postText" id="postText" rows="5" cols="70"></textarea><br><br>
            <input type="submit" value="Submit" name="submit">
			<input type="hidden" id="imagedata" name="imagedata" />
        </form>
        <script>

            var canvas = document.getElementById("imageCanvas");
            var canvasContext = canvas.getContext("2d");

			var base_image = new Image();
            base_image.src = "noimage.jpg";
            canvasContext.drawImage(base_image, 100, 100);

            function uploadImage()
            {
                var uploadedImage = document.createElement("IMG");

                var fileToOpen = document.getElementById("fileToUpload").value;
		
				fileToOpen = fileToOpen.replace("C:\\fakepath\\","");

				uploadedImage.setAttribute("src", fileToOpen);
                uploadedImage.setAttribute("width", "640");
                uploadedImage.setAttribute("height", "480");
                uploadedImage.setAttribute("alt", "Uploaded image");
                //document.body.appendChild(uploadedImage); //!

				canvasContext.drawImage(uploadedImage,0,0,640,480);

				var imageData = canvasContext.getImageData(0, 0, 640, 480);

				document.getElementById("imagedata").value = imageData.data;

				//document.getElementById("imagedata").value = "1,2,3";

            }

        </script>
    </body>
</html>