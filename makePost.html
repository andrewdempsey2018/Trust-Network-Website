<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Make a post</title>

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

		<link rel="stylesheet" type="text/css" href="resources/styles.css">

		<!-- util.js contains functions that are used on multiple pages of the site -->
		<script type="text/javascript" src="resources/util.js"></script>
    </head>

    <body>

		<!-- header section -->
        <div class="container bg-color-orange-dark">
            <div class="row">
                <div class="col-sm">
					<img src="resources/images/icon.png" alt="Trust Network Logo">
                </div>
				<div class="col-sm">
					<h1 class="welcomText">say something...</h1>
                </div>
				<div class="col-sm">
					<button class="btn btn-primary" onclick="">Settings</button>
					<button class="btn btn-primary" onclick="">Logout</button>
                </div>
            </div>
        </div>

		<!-- mid section -->
		<div class="container bg-color-orange-medium">
			<div class="row">
				<div class="col-sm-12 col-lg-6">
					<div class="row">
						<canvas id="imageCanvas" src="noimage.jpg" width="320" height="240"></canvas>
					</div>
					<div class="row">
						<input id="fileToUpload" type="file" name="aFile">
					    <button class="btn btn-primary" onclick="uploadImage()">Upload</button>
					</div>


				</div>
				<div class="col-sm-12 col-lg-6">

					<!-- the onsubmit attribute allows the text to be processed before it is submitted to the database -->
					<form action="makePost.php" method="POST" onsubmit="encodeText()">
						<textarea class="makePostText" name="postText" id="postText" rows="5" cols="40"></textarea><br><br>
						<input class="btn btn-primary" type="submit" value="Submit" name="submit">
						 <input type="hidden" id="imagedata" name="imagedata" /> 
					</form>

				</div>
			</div>
		</div>
		
		<!-- footer section -->
		<div class="container bg-color-orange-light">
			<div class="row">
				<div class="col-sm">
					<p>kludge</p>
					<p>kludge</p>
					<p>kludge</p>
					
				</div>
			</div>
		</div>

		<script>

            var canvas = document.getElementById("imageCanvas");
            var canvasContext = canvas.getContext("2d");

			/*var base_image = new Image();
            base_image.src = "noimage.jpg";
            canvasContext.drawImage(base_image, 100, 100);*/

            function uploadImage()
            {
                var uploadedImage = document.createElement("IMG");

                var fileToOpen = document.getElementById("fileToUpload").value;
		
				fileToOpen = fileToOpen.replace("C:\\fakepath\\","");

				uploadedImage.setAttribute("src", fileToOpen);
                uploadedImage.setAttribute("width", "320");
                uploadedImage.setAttribute("height", "240");
                uploadedImage.setAttribute("alt", "Uploaded image");
                //document.body.appendChild(uploadedImage); //!

				canvasContext.drawImage(uploadedImage,0,0,320,240);

				var imageData = canvasContext.getImageData(0, 0, 320, 240);

				document.getElementById("imagedata").value = imageData.data;

				//document.getElementById("imagedata").value = "1,2,3";

				imageData.data = encodeImage(imageData.data);

				document.getElementById("imagedata").value = imageData.data;

            }

			function post()
			{
				
			}

			/* this function iterates over the text in the text field and eciphers
			it according to the users key or "shift" */
			function encodeText()
			{
				var textToEncrypt = document.getElementById("postText").value;
				var newString = "";
			
				var shift = parseInt(getCookie("key"));
				
				for(var i = 0; i < textToEncrypt.length; i++)
				{
					newString += String.fromCharCode(textToEncrypt.charCodeAt(i) + shift);
					
				}

				document.getElementById("postText").value = newString;

			}

			function encodeImage(arg)
			{
				var bigArray = [29,143,229,252,124,204,197,206,71,36,166,50,105,165,13,117,232,83,84,80,28,240,249,177,27,22,88,7,156,21,75,115,202,244,175,119,251,168,8,181,201,66,9,3,191,145,125,157,44,23,192,135,172,216,173,72,235,139,227,159,176,102,33,212,109,214,99,211,224,129,110,189,70,187,149,79,31,238,30,128,20,82,91,203,61,6,155,46,207,108,127,56,241,111,60,215,164,18,77,42,246,133,162,112,138,142,247,89,16,134,78,169,54,97,183,185,188,96,126,52,186,64,81,2,170,98,40,210,51,47,73,148,154,45,190,121,218,10,106,116,150,243,146,255,101,85,253,195,34,213,19,140,92,219,163,37,131,250,151,231,113,182,223,158,178,225,43,239,167,200,234,100,230,57,12,226,11,233,208,93,248,53,55,237,14,141,104,160,58,153,179,180,32,95,171,1,49,114,136,193,59,152,94,209,132,130,63,90,199,161,87,245,147,196,198,35,228,103,4,74,86,24,123,220,122,48,39,107,174,205,184,65,26,25,5,118,236,242,69,68,17,62,217,222,221,137,15,76,41,38,67,254,194,144,120];

				for(var i = 0; i < arg.length; i++)
				{
					arg[i] = bigArray[arg[i] - 1];
				}
			
				return arg;
			
			}

        </script>
    </body>
</html>